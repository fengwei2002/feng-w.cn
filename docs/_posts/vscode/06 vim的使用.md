---
title: vim 的基础使用
date: 2020-12-14
tags:
  - vim
---

> 执行 git commit 时又遇到了 vim 的编辑模式
<!-- more -->

## git commit 中的使用

按 i 进行文字读写

读写后 :wq 进行保存退出

通常单步执行： git commit -m ""，当文字较多的时候就调用 vim 编辑模式

## vim 认知

刚开始用 VIM 打开文件的时候，需要从宏观的去了解一下 VIM 这个编辑器。

VIM 有四个模式，：

### 正常模式 (Normal-mode)

正常模式一般用于浏览文件，也包括一些复制、粘贴、删除等操作。这时击键时，一些组合键就是 vim 的功能键，而不会在文本中键入对应的字符。

在这个模式下，我们可以通过键盘在文本中快速移动光标，光标范围从小到大是字符、单词、行、句子、段落和屏幕。
启动 VIM 后默认位于正常模式。不论是什么模式，按一下 <Esc> 键 ( 有时可能需要按两下，插入模式按一下 Esc ，就会切换到正常模式，命令模式或者可视模式下执行完操作以后，就会自动进入正常模式，如果进入命令模式或者可视模式没有执行任何操作，按两下 Esc 即可 ）都会进入正常模式。

下面的三个模式都是过键盘上相应的键位去触发的。

### 插入模式 (Insert-mode)

按 i 键会进行插入模式。该模式启动以后，就会进入编辑状态，通过键盘输入内容。

### 命令模式 (Command-mode)

在正常模式中，按下：（冒号）键或者/ （斜杠），会进入命令模式。在命令模式中可以执行一些输入并执行一些 VIM 或插件提供的指令，就像在 shell 里一样。这些指令包括设置环境、文件操作、调用某个功能等等。

### 可视模式 (Visual-mode)

在正常模式按下 v, V, <Ctrl>+v，可以进入可视模式。可视模式中的操作有点像拿鼠标进行操作，选择文本的时候有一种鼠标选择的即视感，有时候会很方便。
（通常 VIM 中复制一段形状不规则的代码就是通过可视模式进行复制的）

以上是关于 VIM 四种模式的解读，我们在使用 VIM 操作文本的时候，编辑区底部一般都会显示当前处于什么模式下  
（插入模式会有 INSERT 提示，可视模式会有 VISUAL 或者 VISUAL LINE 的提示）。

## Esc

VIM 有一个很重要的按键需要一开始就做出说明，那就是键盘中的 <ESC> , 这个按键用来切换模式，该按键可以快速切换到正常模式。
<ESC> 这个按键有点特殊，它脱离了主键盘区，每次操作这个按键的时候都会有些蛮烦。估计很多使用 VIM 的人都会有这个痛点，因此有了一个解决方案，control + [ 这两个按键取代 <ESC>。

曾经很长一段时间我都是用 control + [ 用来取代 <ESC> ，但是还是感觉有些难受？

VIM 有一个配置文件，在 linux 系统中，该配置文件是 `.vimrc` , 该文件位于 ～ 目录下面 （～ 目录是家目录，也就是用户目录），是一个隐藏文件，如果该文件不存在可以手动创建一个。

`.vimrc` 可以有很多配置，例如显示行号，快捷键配置，插件配置等等。  
VIM 很多个性化的设置都离不开这个配置文件。`.vimrc` 有一个特别重要的配置，那就是配置如下的一行：

```
 #将 ESC 键映射为两次 j 键                                      
inoremap qq <Esc>
```

这个配置是将 <ESC> 功能键用 qq （连续按两次 q) 来取代。这个配置可以很大程度提高 VIM 的使用效率 否则退出文件的时候有些远离键盘不太雅观

具体用什么来替换 Esc 还是看个人爱好，反正离键盘的中区域应该近一些
## 用 vim 打开文件

### 用 vim 打开一个文件

现在假如有一个文件 file1 , 只需要在文件前面加上 vim 关键字就好：
`vim file1`
上面这个命令将会打开 file1 这个文件，file1 是指你具体操作的文件名
当不存在这个文件的时候，就进行创建，使用该命令进入 vim 后 直接进入 vim 的插入模式

### 用 VIM 一次性打开多个文件

现在有多个文件 `file1 ，file2 , ... ,filen.`

现在举例打开两个文件 `file1，file2`

`vim file1 file2`

该方式打开文件，显示屏默认显示第一个文件也就是 file1，  
VIM 的正常模式下按下键盘上的冒号 `：`这时会在显示屏底部出现冒号` ：`（进入了 VIM 的命令模式），  
然后在输入 ls （ls 为调出列表信息的一个命令），  
屏幕上会出现打开的所有文件的序号和文件名，我们继续输入冒号 ： ，然后输入 bn （这里的 n 需要做一个解释并不是键盘上的 n , 而是文件序号的代指，如 b1 代表显示屏上切换到第一个文件，b2 代表显示屏上切换到第二个文件）。

`:ls`

上面这个命令将会列出 VIM 打开的所有文件。

`:b2`

上面的这个命令将会在显示屏上显示第二个文件。

### 在显示屏上一次性显示多个文件

VIM 可以实现分屏操作，一个屏幕被多个文件给分占，有左右和上下两种分屏的方式。

左右分屏如下操作：

`vim -On file1 file2 ... filen`

这里的 n （ n 是要打开的具体文件的数目：1,2,3 ...）是代表有几个文件需要分屏，从左至右依次显示 n 个文件。

上下分屏如下操作：

`vim -on file1 file2 ... filen`

这个命令跟上一个命令不同的是其中的参数 -on（ n 是要打开的具体文件的数目：1,2,3 ...） 中的 o 是小写，这样将会上下依次显示 n 个文件。

上下分屏显示文件使用小写 o 记号+n 
左右分屏显示文件使用大写 O 记号+n

`vim -O2 test01.cpp test02.cpp `

## 分屏操作

记住一个重要的组合键 `Ctrl + w`, 操作分屏离不开这个组合键  （关于窗口的操作 windows-w）

### vim 文件分屏

按住组合键 Ctrl + w ，然后在按下 s

`Ctrl + w s`

上面这个命令将会上下分割当前打开的文件。

按住冒号`：`，紧接着输入 `sp` , 在键入文件名，如下：

`:sp file`

上面的这个命令将会上下分割当前文件和新打开的 file 。

按住组合键 `Ctrl + w `, 然后在按下` v`

`Ctrl +w v`

上面的这个命令将会左右分割当前的文件

按住冒号 `：`，紧接着输入 `vsp` , 在键入文件名称，如下：

`:vsp file`

上面的这个命令将会左右分割当前打开的文件和新打开的文件 file 。

### 切换光标，移动分屏

1. 切换左右分屏的光标 ：

将当前光标定位到左边的屏幕 `Ctrl + w h`

将当前的光标定位到右边的屏幕 `Ctrl + w l`

（因为 vim 和 linux 中使用 hjkl 代表上下左右，所以 ctrl+w+h 代表将光标移动到左屏幕，ctrl+w+l 代表将光标移动到右边的屏幕，而不是使用 lr 代表左右，这里的键盘的地理位置和功能也对应，h 在左，l 在右）

2. 移动左右分屏 ：

将当前的分屏移动到左边 `Ctrl + w H`

将当前的分屏移动到右边 `Ctrl + w L`

与移动光标操作不同的是，需要 caps 进行锁定，大写字母为分屏的相关操作

3. 切换上下分屏的光标 ：

将当前的光标移动到下面的分屏 `Ctrl + w j`

将当前光标移动到上面的分屏 `Ctrl + w k`

4. 移动上下分屏：

将当前的分屏移动到下面的分屏 `Ctrl + w J`

将当前的分屏移动到上面的分屏 `Ctrl + w K`

### 关闭分屏

这个命令是关闭当前的分屏
`Ctrl + w c` （close）

上面的这个命令也是关闭当前的分屏，如果是最后一个分屏将会退出 VI 不太行
`Ctrl + w q`

## VIM 的退出

VIM 的最终操作就是 VIM 的退出，命令模式下执行以下操作就可以实现对应的功能

保存当前对文件的修改，但是不退出文件。`:w`

强制保存但是不退出文件。`:w!`

保存当前的文件修改到 file 文件当中。`:w file`
（例如写了一个 cpp 文件，然后执行这个命令就可以将写好的内容放到另一个已经创建好的 cpp 文件，就是 windows 里面的：test.cpp 已存在，是否覆盖？）

退出文件，对文件的修改不做保存。`:q!` （相当于强制退出）

退出所有的文件，对所有的文件修改都不做保存。`:qa!` （quit all ！）

退出文件并保存对文件的修改。`:wq` （这个就是最常用的~）

退出文件并保存对文件的修改。`:x` （功能等价：wq）

打开另一个文件。`:e file` （edit-e）

放弃对文件的所有修改，恢复文件到上次保存的位置。`:e!`（代表文件编辑失效，edit ！）

另存为 file。`:saveas file` （saveas 没有空格）

当打开多个文件的时候可以输入 :bn 和 :bp 进行上一个文件或者下一个文件的切换。`:bn 和 :bp`  
（这个之前有说）切换后再进行想添加的操作

## 使用 VIM 编辑文本

这里有必要再强调一下，在使用 VIM 打开文件的时候，这时候的状态是正常模式（Normal-mode）, 请务必记住这个模式，如果你不确定当前是否处在正常模式，请连续按两下键盘上的 ESC（或者自定义以后的按键：qq），VIM 处理编辑文本需要从正常模式 (Normal) 切换到插入模式 (Insert-mode), 进入插入模式的时候你应该会在屏幕底部看到提示，这时候就可以编辑文本了。

（现在的 vim 都已经存在汉化了，左下角提示为插入/INSERT，可视，等等）

### 从正常模式进入插入模式

请记住下面几个常用启动录入文本的键盘字符 `i,I,a,A,o,O,s,S` 。（一个 ios，aios）

`i` 是在光标所在的字符之前插入需要录入的文本。

`I` 是在光标所在行的行首插入需要录入的文本。

`a` 是在光标所在的字符之后插入需要录入的文本。

`A` 是在光标所在行的行尾插入需要录入的文本。

`o` 是光标所在行的下一行行首插入需要录入的文本。

`O` 是光标所在行的上一行行首插入需要录入的文本。

`s` 删除光标所在处的字符然后插入需要录入的文本。

`S` 删除光标所在行，在当前行的行首开始插入需要录入的文本

vim 中的光标是宽的，不是一个窄条，所以存在 s 操作

还有一个可能经常用到的就是 cw ，删除从光标处开始到该单词结束的所有字符，然后插入需要录入的文本（这个命令是两个字符的合体 cw ）。相当于 Windows 窗口下的鼠标双击进行的单词替换

## VIM 的命令模式

关于命令模式上文有提到过，下面主要来列举几个常用的命令模式操作（命令输入完以后，需要按下 Enter 键去执行命令，和Bash，shell中一样）：

### 行号

文本的行号设置最好不要设置在配置文件中（因为复制文件的时候行号的出现会很麻烦，还得删），在命令行实现就好。

该命令会显示行号`:set nu`

该命令会取消行号。`:set nonu`

定位到 n 行 `:n`


### VIM 进行关键字的查找。

`/{目标字符串}` ：会在文本中匹配相应字符串的地方高亮。（有两种命令模式的起始调用方式~`:` `/`）

查找文本中匹配的目标字符串，查到以后，输入键盘上的 n 会去寻找下一个匹配，N 会去寻找上一个匹配。  
(next)

### VIM 处理大小写的区分

编辑器将不会区分大小写，如果你进行该设置之后，进行关键字查询只要是字符相同不会区分大小写都会进行匹配。

`:set ic`

区分大小写的查询。

`:set noic`

### VIM 删除多行文本

n1 和 n2 指的是起始行号和结束行号，d 是删除关键字 `:n1,n2d` （开启行号显示后挺好用的）
<!-- 
### VIM 处理文本的替换

:{作用范围}s/{目标}/{替换}/{替换的标志}

作用范围分为当前行、全文、选区等等。

:s/zempty/handsome/g

将会把当前光标所在行的 zempty 替换成 handsome

:%s/zempty/handsome/g

将会把全文中的 zempty 替换成 handsome

:n1,n2s/zempty/handsome/g

这里的 n1 和 n2 值得是行号，将会替换掉 n1 到 n2 的所有 zempty 为 handsome.

选区，在可视模式下选择区域后输入 : ，VIM 会自动补全为 :'<,'>。

:'<,'>s/zempty/handsome/g

这个操作咋一看起来有点懵逼，这个操作是可视模式 (Visual-mode) 下选区中的替换操作（可视模式下文会谈到），可视模式下输入：会自动补全 :'<,'> 这个是可视范围下的操作范围，类似于 % 和 n1,n2，代表操作的文本范围，上面的例子就是替换掉可视区域的 zempty 为 handsome。 -->